<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>개발새발 블로그</title>
  
  <subtitle>개발새발 블로그</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://tuwhit.github.io/"/>
  <updated>2018-02-15T05:07:49.362Z</updated>
  <id>https://tuwhit.github.io/</id>
  
  <author>
    <name>Hyunkyung Ahn</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Lambda, Kinesis Firehose 를 이용해서 AuroraDB에 추가된 데이터를 실시간으로 ES에 저장하기</title>
    <link href="https://tuwhit.github.io/2018/02/15/aurora-to-es/"/>
    <id>https://tuwhit.github.io/2018/02/15/aurora-to-es/</id>
    <published>2018-02-15T04:41:08.000Z</published>
    <updated>2018-02-15T05:07:49.362Z</updated>
    
    <content type="html"><![CDATA[<hr><p>이번엔 Kinesis Firehose 의 목적지를 Elasticsearch로 설정해서 테스트해봤다. Elasticsearch 새 도메인 올리는데 시간이 좀 걸리니 미리 만들어 두는게 좋음.</p><ol><li><a href="http://tuwhit.github.io/2018/01/23/aurora-data-streaming/">Lambda, Kinesis Firehose 를 이용해서 AuroraDB에 추가된 데이터 실시간으로 캡쳐하기</a> 문서 참고해서 AuroraDB, Lambda 설정까지 완료</li><li>새 Elasticsearch domain을 생성<ul><li>kinesis firehose가 elasticsearch 6.0은 지원을 안하니 그 아래 버전으로 생성할것. Elasticsearch 6.0 is not currently supported by Kinesis Firehose. Contact AWS Support for more information. 에러가 뜬다… 따흐흑…</li></ul></li><li><p>위 domain에 index, type을 생성</p><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"properties"</span>: &#123;</div><div class="line">        <span class="attr">"ItemID"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"integer"</span>&#125;,</div><div class="line">        <span class="attr">"Category"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"text"</span>&#125;,</div><div class="line">        <span class="attr">"Price"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"float"</span>&#125;,</div><div class="line">        <span class="attr">"Quantity"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"integer"</span>&#125;,</div><div class="line">        <span class="attr">"OrderDate"</span>:  &#123;</div><div class="line">          <span class="attr">"type"</span>: <span class="string">"date"</span>,</div><div class="line">          <span class="attr">"format"</span>: <span class="string">"strict_date_optional_time||epoch_millis"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"DestinationState"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"text"</span> &#125;,</div><div class="line">        <span class="attr">"ShippingType"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"text"</span>&#125;,</div><div class="line">        <span class="attr">"Referral"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"text"</span>&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li><li><p>새 Kinesis Firehose 를 생성</p><ul><li>destination을 Amazon Elasticsearch service 선택</li><li>Amazon Elasticsearch Service destination에 위에서 만든 elasticsearch domain, index, type을 입력</li><li>IAM에 ES에 대한 권한이 제대로 명시돼 있는지 확인 (알아서 만들어줌)</li></ul></li><li><p>Lambda code 수정</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> boto3</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> logging</div><div class="line"></div><div class="line">firehose = boto3.client(<span class="string">'firehose'</span>, region_name=<span class="string">'리전이름'</span>)</div><div class="line">stream_name = <span class="string">'delivery stream 이름'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">lambda_handler</span><span class="params">(event, context)</span>:</span></div><div class="line">    <span class="comment"># for ES</span></div><div class="line">    firehose_data = &#123;</div><div class="line">        <span class="string">"ItemID"</span>: event[<span class="string">'ItemID'</span>],</div><div class="line">        <span class="string">"Category"</span>: event[<span class="string">'Category'</span>],</div><div class="line">        <span class="string">"Price"</span>: event[<span class="string">'Price'</span>],</div><div class="line">        <span class="string">"Quantity"</span>: event[<span class="string">'Quantity'</span>],</div><div class="line">        <span class="string">"OrderDate"</span>: event[<span class="string">'OrderDate'</span>].split()[<span class="number">0</span>] + <span class="string">"T"</span> + event[<span class="string">'OrderDate'</span>].split()[<span class="number">1</span>],</div><div class="line">        <span class="string">"DestinationState"</span>: event[<span class="string">'DestinationState'</span>],</div><div class="line">        <span class="string">"ShippingType"</span>: event[<span class="string">'ShippingType'</span>],</div><div class="line">        <span class="string">"Referral"</span>: event[<span class="string">'Referral'</span>]</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    firehose_data = &#123;<span class="string">'Data'</span>: json.dumps(firehose_data)&#125;</div><div class="line">    logging.info(json.dumps(firehose_data))</div><div class="line"></div><div class="line">    result = firehose.put_record(DeliveryStreamName=stream_name,Record=firehose_data)</div></pre></td></tr></table></figure></li><li><p>AuroraDB 테이블에 데이터 추가</p></li><li>얼마후에 ES에 _search 쿼리 날려보면 데이터가 추가된것을 확인할수 있음</li></ol><hr><ul><li>기타 참고<ul><li>kinesis 에서 데이터가 잘 넘어가는지 CloudWatch에서 확인<br>실패시 S3에 로그저장됨</li><li>Datetime 포맷은 ES의 Date 포맷에 맞춰서 넣을것</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;p&gt;이번엔 Kinesis Firehose 의 목적지를 Elasticsearch로 설정해서 테스트해봤다. Elasticsearch 새 도메인 올리는데 시간이 좀 걸리니 미리 만들어 두는게 좋음.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;http
      
    
    </summary>
    
    
      <category term="AWS" scheme="https://tuwhit.github.io/tags/AWS/"/>
    
      <category term="Lambda" scheme="https://tuwhit.github.io/tags/Lambda/"/>
    
      <category term="Kinesis Firehose" scheme="https://tuwhit.github.io/tags/Kinesis-Firehose/"/>
    
      <category term="AuroraDB" scheme="https://tuwhit.github.io/tags/AuroraDB/"/>
    
      <category term="Elasticsearch" scheme="https://tuwhit.github.io/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Lambda, Kinesis Firehose 를 이용해서 AuroraDB에 추가된 데이터 실시간으로 캡쳐하기</title>
    <link href="https://tuwhit.github.io/2018/01/23/aurora-data-streaming/"/>
    <id>https://tuwhit.github.io/2018/01/23/aurora-data-streaming/</id>
    <published>2018-01-23T11:23:50.000Z</published>
    <updated>2018-01-23T11:44:29.997Z</updated>
    
    <content type="html"><![CDATA[<hr><p><img src="/images/Workflow.jpg" alt="Workflow"></p><p>데이터 스트리밍 관련 리서치를 하다가 <a href="https://aws.amazon.com/ko/blogs/database/capturing-data-changes-in-amazon-aurora-using-aws-lambda/" target="_blank" rel="external">이런</a> 문서가 있길래 직접 해봤다.(AuroraStream이 따로 없고 DynamoStream만 있는듯) 회사에선 AuroraDB를 써서 일단 요 실습을 따라해보는걸로.</p><p>사실 자세한건 위 링크에 다 나와있다…ㅎㅎ;; 간단히 요약하면서 중간중간 삽질한것만 추가로 기록해봤음.</p><ol><li>Kinesis 에서새로운 delivery stream을 생성하고 Destination을 S3로 선택해준뒤, 원하는 버켓을 지정해줌</li><li>AuroraDB 와 같은 리전에서 새 Lambda function 을 생성<ul><li>Lambda 코드에서 stream_name 만 1번에서 만든 stream 이름으로 변경</li><li>혹시 firehose 가 다른 리전에 있다면 firehose = boto3.client(‘firehose’, region_name=’리전 이름’) 이렇게 뒤에 리전 이름 추가해줌</li></ul></li><li>AuroraDB에서 원하는 테이블에 프로시저, 트리거 생성<ul><li>프로시저에서 2에서 생성해준 Lambda function의 arn 으로 설정해줌</li></ul></li><li>AuroraDB parameter group에서 aws_default_lambda_role 의 value 를 lambda 를 실행시킬수있는 role의 arn으로 설정<ul><li>안해주면 Missing Credentials: Cannot instrantiate Lambda Client 에러남</li></ul></li><li>테이블에 데이터를 추가<ul><li>Lambda에서 예외처리를 따로 안해줘서 필드가 null 일땐 에러나는듯</li></ul></li><li>좀있다가 S3 버킷 확인해보면 요렇게 파일이 생겨있음<br><img src="/images/AuroraToS3.png" alt="S3에 생긴 파일을 확인해보면!"></li><li>그래도 에러나면 IAM 제대로 설정돼있는지 확인 ㄱㄱ</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;p&gt;&lt;img src=&quot;/images/Workflow.jpg&quot; alt=&quot;Workflow&quot;&gt;&lt;/p&gt;
&lt;p&gt;데이터 스트리밍 관련 리서치를 하다가 &lt;a href=&quot;https://aws.amazon.com/ko/blogs/database/captur
      
    
    </summary>
    
    
      <category term="AWS" scheme="https://tuwhit.github.io/tags/AWS/"/>
    
      <category term="Lambda" scheme="https://tuwhit.github.io/tags/Lambda/"/>
    
      <category term="Kinesis Firehose" scheme="https://tuwhit.github.io/tags/Kinesis-Firehose/"/>
    
      <category term="S3" scheme="https://tuwhit.github.io/tags/S3/"/>
    
      <category term="AuroraDB" scheme="https://tuwhit.github.io/tags/AuroraDB/"/>
    
  </entry>
  
  <entry>
    <title>Data Pipeline로 S3에서 DynamoDB로 데이터 import 시키기</title>
    <link href="https://tuwhit.github.io/2017/11/19/import-to-dynamodb/"/>
    <id>https://tuwhit.github.io/2017/11/19/import-to-dynamodb/</id>
    <published>2017-11-19T08:57:45.000Z</published>
    <updated>2017-11-19T09:45:30.000Z</updated>
    
    <content type="html"><![CDATA[<hr><p>이번엔 Data Pipeline을 이용해서 S3에서 DynamoDB로 데이터를 import 시키는 방법을 정리해본다.</p><p>DynamoDB에 item을 생성하는데(이틀간 삽질하며) 아래의 방식들을 써봤다.</p><ol><li>AWS console에서 직접 생성</li><li>ruby SDK를 이용해서 csv 파일을 한줄한줄 읽어서 item 생성</li><li>aws dynamodb batch-write-item –request-items file://파일명 명령어를 이용(형식 맞춰줘야함)</li><li>DataPipeline을 이용해서 S3의 파일을 import</li></ol><p>1억건의 데이터를 넣는데는 1, 2번으론 무리가 있었고 3번도 파일 용량제한이 있는지 에러를 내뱉었다. 결국 Data Pipeline으로…</p><p>Data Pipeline 을 생성하면 DynamoDB 템플릿이 존재한다. <strong>Import DynamoDB backup data from S3</strong> 을 선택하고 생성해준다. 그리고 Parameter 들만 잘 설정해주면 됨. 유의해야할것은 Data Pipeline을 생성한 리전과 S3 bucket, DynamoDB의 리전이 같아야한다. 안그러면 에러를 뿜뿜함.</p><p><img src="/images/datapipeline_setting.png" alt="parameter 설정"></p><center style="color: grey; font-size: 14px;">아니 리전 입력하라고 해놓고 왜 에러나는지 모를…</center><p>파일형식도 맞춰야한다. 열심히 구글링을 해봐도 없어서 새로 Data Pipeline을 생성해서 반대로 Export 시켜봤다 ㅠㅠ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="string">"amount"</span>:&#123;<span class="string">"s"</span>:<span class="string">"8"</span>&#125;,<span class="string">"shop_id"</span>:&#123;<span class="string">"s"</span>:<span class="string">"100000"</span>&#125;,<span class="string">"gender"</span>:&#123;<span class="string">"s"</span>:<span class="string">"1"</span>&#125;,<span class="string">"Id"</span>:&#123;<span class="string">"n"</span>:<span class="string">"1"</span>&#125;,<span class="string">"user_id"</span>:&#123;<span class="string">"s"</span>:<span class="string">"70167727"</span>&#125;,<span class="string">"date"</span>:&#123;<span class="string">"s"</span>:<span class="string">"2017-01-22"</span>&#125;,<span class="string">"birth_year"</span>:&#123;<span class="string">"s"</span>:<span class="string">"1955"</span>&#125;&#125;</div><div class="line">&#123;<span class="string">"amount"</span>:&#123;<span class="string">"s"</span>:<span class="string">"17"</span>&#125;,<span class="string">"shop_id"</span>:&#123;<span class="string">"s"</span>:<span class="string">"100001"</span>&#125;,<span class="string">"gender"</span>:&#123;<span class="string">"s"</span>:<span class="string">"0"</span>&#125;,<span class="string">"Id"</span>:&#123;<span class="string">"n"</span>:<span class="string">"2"</span>&#125;,<span class="string">"user_id"</span>:&#123;<span class="string">"s"</span>:<span class="string">"29015489"</span>&#125;,<span class="string">"date"</span>:&#123;<span class="string">"s"</span>:<span class="string">"2017-07-05"</span>&#125;,<span class="string">"birth_year"</span>:&#123;<span class="string">"s"</span>:<span class="string">"2010"</span>&#125;&#125;</div><div class="line">&#123;<span class="string">"amount"</span>:&#123;<span class="string">"s"</span>:<span class="string">"11"</span>&#125;,<span class="string">"shop_id"</span>:&#123;<span class="string">"s"</span>:<span class="string">"100001"</span>&#125;,<span class="string">"gender"</span>:&#123;<span class="string">"s"</span>:<span class="string">"1"</span>&#125;,<span class="string">"Id"</span>:&#123;<span class="string">"n"</span>:<span class="string">"4"</span>&#125;,<span class="string">"user_id"</span>:&#123;<span class="string">"s"</span>:<span class="string">"90567446"</span>&#125;,<span class="string">"date"</span>:&#123;<span class="string">"s"</span>:<span class="string">"2017-01-14"</span>&#125;,<span class="string">"birth_year"</span>:&#123;<span class="string">"s"</span>:<span class="string">"1953"</span>&#125;&#125;</div></pre></td></tr></table></figure><p> 그 결과, item별로 {필드1: {데이터 형식: 값}, 필드2: {데이터 형식: 값}} 요런 형태로 파일이 만들어졌다. 그래서 기존의 csv 파일을 위 형태로 컨버팅후(스크립트 만들어서 돌림ㅠㅠ) Data Pipeline을 실행시켜보니 잘 들어감!</p><p>그런데 write 속도가 너무 느려서 DynamoDB의 write capacity 값을 올려줬는데도 일정값 이상으로 안올라오길래 왜그런가 했더니 Data Pipeline 설정에 myDDBWriteThroughputRatio 필드가 있었다.(0 ~ 1 사이의 값으로 입력가능) 1으로 수정해주니 입력값으로 잘 올라옴.</p><p>다른건 몰라도 이제 DynamoDB에 데이터 입력하는덴 전문가된듯. -_-</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;p&gt;이번엔 Data Pipeline을 이용해서 S3에서 DynamoDB로 데이터를 import 시키는 방법을 정리해본다.&lt;/p&gt;
&lt;p&gt;DynamoDB에 item을 생성하는데(이틀간 삽질하며) 아래의 방식들을 써봤다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
      
    
    </summary>
    
    
      <category term="AWS" scheme="https://tuwhit.github.io/tags/AWS/"/>
    
      <category term="S3" scheme="https://tuwhit.github.io/tags/S3/"/>
    
      <category term="DynamoDB" scheme="https://tuwhit.github.io/tags/DynamoDB/"/>
    
      <category term="Data Pipeline" scheme="https://tuwhit.github.io/tags/Data-Pipeline/"/>
    
  </entry>
  
  <entry>
    <title>S3에 있는 csv 파일을 AuroraDB로 import 시키기</title>
    <link href="https://tuwhit.github.io/2017/11/16/import-s3-to-aurora/"/>
    <id>https://tuwhit.github.io/2017/11/16/import-s3-to-aurora/</id>
    <published>2017-11-16T14:14:10.000Z</published>
    <updated>2017-11-16T15:01:46.000Z</updated>
    
    <content type="html"><![CDATA[<hr><p>데이터 분석 관련 프로젝트를 진행중이라 간만에 포스팅을 한다. 아마 당분간 프로젝트를 진행하며 겪었던 삽질기를 계속 포스팅하지 않을까 싶음… 처음 해보는것들 투성이라 팀원들이 모두 프로야근러가 되었다. 흑흑ㅠㅠ 오늘은 문서가 잘 정리돼있어서 꽤 쉽게 클리어했던 S3에 있는 csv 파일을 AuroraDB에 import 시키는 방법을 정리해본다.</p><p>AuroraDB instance를 생성하고 IAM role(case는 물론 RDS로 선택)을 만들어준다. 생성후 permission 탭에서 Attach policy를 클릭하여 S3에 Access할수 있도록 <strong>AmazonS3FullAccess</strong> 를 추가해준다.</p><p>그리고 다시 RDS로 돌아가 Parameter group을 생성해준다. 여기서 Type은  <strong>DB Cluster Parameter Group</strong> 으로 설정한다. 생성후에 <strong>aurora_load_from_s3_role</strong> 의 value 값을 위에서 만든 IAM role ARN로 입력해준다.</p><p>cluster 메뉴에서 해당 cluster 수정 페이지로 이동하여 DB Cluster Parameter Group을 위에서 생성해준 걸로 설정해준다. 다음 페이지로 넘어가서 Apply Immediately 선택후 완료. 다시 cluster 메뉴로 돌아와 해당 cluster 선택 후 Manage IAM roles 페이지로 이동하여 위에서 만들어준 IAM role을 추가해준다.</p><p>여기까지가 데이터를 로드하기위한 준비 끝.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -h [DB Endpoint] -P [port] -u [user name] -p</div></pre></td></tr></table></figure><p>이후 패스워드를 입력하면 해당 AuroraDB로 접속하게된다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">load data from s3 &apos;s3-[region]://[bucket name]/[file name]&apos;</div><div class="line">into table [table name]</div><div class="line">fields terminated by &apos;,&apos;;</div></pre></td></tr></table></figure><p>이렇게 하면 s3에 있는 csv 파일의 데이터를 지정한 테이블로 로드하게 된다. 1억 row 짜리 데이터 올리는데 한시간가량 걸렸던것 같음.</p><p>위 명령어만으로 로드하면 필드명으로 구분이 안되고 파일에 입력된 순서대로 DB에 저장되니 유의하자. 로드할때 여러가지 옵션이 있는데 <a href="http://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/Aurora.LoadFromS3.html" target="_blank" rel="external">여기</a>에서 확인할 수 있다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;p&gt;데이터 분석 관련 프로젝트를 진행중이라 간만에 포스팅을 한다. 아마 당분간 프로젝트를 진행하며 겪었던 삽질기를 계속 포스팅하지 않을까 싶음… 처음 해보는것들 투성이라 팀원들이 모두 프로야근러가 되었다. 흑흑ㅠㅠ 오늘은 문서가 잘 정리돼있
      
    
    </summary>
    
    
      <category term="AWS" scheme="https://tuwhit.github.io/tags/AWS/"/>
    
      <category term="S3" scheme="https://tuwhit.github.io/tags/S3/"/>
    
      <category term="AuroraDB" scheme="https://tuwhit.github.io/tags/AuroraDB/"/>
    
      <category term="Database" scheme="https://tuwhit.github.io/tags/Database/"/>
    
      <category term="RDS" scheme="https://tuwhit.github.io/tags/RDS/"/>
    
  </entry>
  
  <entry>
    <title>AWS 도커 컨테이너 배포 자동화 실습</title>
    <link href="https://tuwhit.github.io/2017/10/27/code-deploy/"/>
    <id>https://tuwhit.github.io/2017/10/27/code-deploy/</id>
    <published>2017-10-27T12:51:05.000Z</published>
    <updated>2017-11-16T14:12:41.000Z</updated>
    
    <content type="html"><![CDATA[<hr><p>3일전 Gaming on AWS에 참석해서 ‘도커 컨테이너 배포 자동화 실습’을 진행했다. 회사에서도 도커 컨테이너를 이용해서 배포를 하고있어서(수동이지만) 적용해볼 수 있을것 같다.</p><p>당일에는 실습자료를 보고 따라하기 급급했어서 다시 한번 정리해봤다.</p><p><img src="/images/architecture.png" alt="실습 아키텍쳐"></p><blockquote><p>CodePipeline으로 배포 프로세스를 구성하고 S3에 저장된 소스코드를 CodeBuild를 통해 컴파일 및 컨테이너 이미지 생성한다. 그리고 CloudFormation을 이용해 ECS에 배포한다.</p></blockquote><ol><li>CodePipeline 생성</li><li>Source provider는 소스코드가 저장된 S3 버킷으로 설정하고 CodeBuild를 build provider로 선택</li><li>코드가 build되어 생성된 컨테이너 이미지는 ECR repository에 저장</li><li>환경 설정 파일도 S3에 저장하고 CodePipeline 에서 해당 파일을 사용하는 Source 액션 추가</li><li>Dockerize 하는 액션 추가 (여기까지가 Build 스테이지)</li><li>Deploy 스테이지 추가</li><li>CloudFormation으로 환경설정 파일을 참조하여 deploy</li></ol><p>설정 완료 후 S3에 환경 설정 파일, 어플리케이션을 업로드하면 CodePipeline 에서 변경사항을 감지하여 배포작업을 수행한다. 왕신기. 추가적으로 Lambda를 이용해서 Blue/Green 배포도 가능하다. 현재 리얼 환경이 아닌 곳으로 배포하고 수동 승인과정을 거치면 환경을 Swap 하도록 할 수 있다.</p><p><img src="/images/code_pipeline_setting.png" alt="code pipeline 설정"></p><center style="color: grey; font-size: 14px;">이거슨 빙산의 일각이다</center><p>간단히 정리해놔서 그렇지 실제로 콘솔에서 설정해줘야 하는 것들이 굉장히 많았다. (ECS, ELB, ECR, IAM 등등…) 그 하나하나를 이해하기는 좀 어려워서 따로 공부가 필요할 것 같다. 그리고 실습에서 제공된 환경설정파일들도 실제 서비스 환경설정파일들이랑 같이 보면 좋을듯.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;p&gt;3일전 Gaming on AWS에 참석해서 ‘도커 컨테이너 배포 자동화 실습’을 진행했다. 회사에서도 도커 컨테이너를 이용해서 배포를 하고있어서(수동이지만) 적용해볼 수 있을것 같다.&lt;/p&gt;
&lt;p&gt;당일에는 실습자료를 보고 따라하기 급급했
      
    
    </summary>
    
    
      <category term="deploy" scheme="https://tuwhit.github.io/tags/deploy/"/>
    
      <category term="AWS" scheme="https://tuwhit.github.io/tags/AWS/"/>
    
      <category term="CodePipeline" scheme="https://tuwhit.github.io/tags/CodePipeline/"/>
    
  </entry>
  
  <entry>
    <title>개복치같은 서버를 살리기위한 삽질기(ing)</title>
    <link href="https://tuwhit.github.io/2017/10/13/server-sabjil/"/>
    <id>https://tuwhit.github.io/2017/10/13/server-sabjil/</id>
    <published>2017-10-13T11:15:21.000Z</published>
    <updated>2017-10-13T11:29:18.000Z</updated>
    
    <content type="html"><![CDATA[<hr><p>작년에 신규 프로젝트를 진행하면서 기존 ruby 서버가 아닌 python 으로 별도의 서버를 띄웠다. Java로 된 별도의 암호화모듈을 사용해야해서 Py4J을 이용했다. 그런데 이 라이브러리의 문제인지 메모리 누수 때문인지 원인은 모르겠지만 2-3주정도 주기로 암호화모듈쪽에서 에러가 나기 시작하면서 그 이후의 모든 요청에서 같은 에러가 발생했다. 기존에 url lib 를 썼던것을 requests 를 사용하도록 수정했지만 에러 발생주기가 조금 길어졌을 뿐 해결이 되지않았다. 일단 원인을 찾는것은 뒤로 미루고 Lambda와 Cloud Watch를 이용해서 매일 새벽2시에 인스턴스를 리붓시키도록 했다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> AWS = <span class="built_in">require</span>(<span class="string">'aws-sdk'</span>);</div><div class="line"></div><div class="line">exports.handler = <span class="function">(<span class="params">event, context, callback</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">var</span> ec2 = <span class="keyword">new</span> AWS.EC2(&#123;<span class="attr">region</span>: <span class="string">'ap-northeast-2'</span>&#125;);</div><div class="line">    </div><div class="line">    ec2.rebootInstances(&#123;<span class="attr">InstanceIds</span> : [<span class="string">'instance-ID'</span>] &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err.stack);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">console</span>.log(data);</div><div class="line">        context.done(err,data);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>이후 몇달간 서버에 이상이 없는듯 하더니 어느날 아예 500에러가 나기시작했다. -_- 원인을 찾아보려 서버에 접속해봤더니 컨테이너가 아예 없었다. 리붓하면서 컨테이너가 제대로 생성되지 않은것 같았다. Docker 관련 지식이 얕아 원인을 알수가 없어서 일단 인스턴스를 새로 생성하는 것으로 해결을 했다. 그리고 UptimeRobot을 이용해 5분에 한번 서버에 request를 보내고, 문제가 있으면 slack으로 alert message를 남기도록 했다.</p><p><img src="/images/KakaoTalk_2017-10-13-20-16-05_Photo_18.png" alt="UptimeRobot"></p><center style="color: grey; font-size: 14px;">이걸 5분만에 설정할수있다니 21세기 스고이</center><p>그런데 깜빡하고 Lambda 코드에 바뀐 인스턴스 ID로 수정하지 않아서(아오) 3주뒤 또 암호화 모듈 에러가 발생했다. 이런 휴먼에러를 발생시키지 않기위해 코드를 몇줄 더 추가했다. ㅠㅠ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> AWS = <span class="built_in">require</span>(<span class="string">'aws-sdk'</span>);</div><div class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);</div><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> POST_OPTIONS = &#123;</div><div class="line">    hostname: <span class="string">'hooks.slack.com'</span>,</div><div class="line">    path: <span class="string">'slack web-hook url'</span>,</div><div class="line">    method: <span class="string">'POST'</span>,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">exports.handler = <span class="function">(<span class="params">event, context, callback</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">var</span> ec2 = <span class="keyword">new</span> AWS.EC2(&#123;<span class="attr">region</span>: <span class="string">'ap-northeast-2'</span>&#125;);</div><div class="line">    <span class="keyword">const</span> failed_message = &#123;</div><div class="line">        channel: <span class="string">'service-alerts'</span>,</div><div class="line">        text: <span class="string">'Instace Reboot Failed'</span></div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="comment">// check if instance exists</span></div><div class="line">    ec2.describeInstances(&#123;<span class="attr">InstanceIds</span> : [<span class="string">'instance-ID'</span>]&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span> (err) &#123;  <span class="comment">// if doesn't exist, send slack alert</span></div><div class="line">            <span class="keyword">var</span> r = https.request(POST_OPTIONS, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</div><div class="line">                        res.setEncoding(<span class="string">'utf8'</span>);</div><div class="line">                        res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">                            context.succeed(<span class="string">"Message Sent: "</span> + data);</div><div class="line">                     &#125;);</div><div class="line">            &#125;).on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;context.fail(<span class="string">"Failed: "</span> + e);&#125; );</div><div class="line">            r.write(util.format(<span class="string">"%j"</span>, failed_message));</div><div class="line">            r.end();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;    <span class="comment">// exist</span></div><div class="line">            <span class="comment">// reboot instance</span></div><div class="line">            ec2.rebootInstances(&#123;<span class="attr">InstanceIds</span> : [<span class="string">'instance-ID'</span>] &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (err) &#123;  <span class="comment">// send slack alert</span></div><div class="line">                <span class="keyword">var</span> r = https.request(POST_OPTIONS, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</div><div class="line">                            res.setEncoding(<span class="string">'utf8'</span>);</div><div class="line">                            res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">                                context.succeed(<span class="string">"Message Sent: "</span> + data);</div><div class="line">                         &#125;);</div><div class="line">                &#125;).on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;context.fail(<span class="string">"Failed: "</span> + e);&#125; );</div><div class="line">                r.write(util.format(<span class="string">"%j"</span>, failed_message));</div><div class="line">                r.end();</div><div class="line">            &#125; <span class="keyword">else</span> <span class="built_in">console</span>.log(data);</div><div class="line">                context.done(err,data);</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p><p>리붓시킬 인스턴스를 먼저 찾고 없으면 슬랙으로 alert message를 보내고, 있으면 해당 인스턴스를 리붓시킨다. 리붓시 에러가 나도 슬랙으로 alert message를 보낸다.</p><p>애초에 에러의 원인을 찾아서 해결했어야하는데 다른일들로 시간적 여유가 없다보니 그때그때 서버만 살리고 뒷전으로 미뤄뒀던 것에 반성을… 틈틈히 시간내서 원인파악을 해야겠다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;p&gt;작년에 신규 프로젝트를 진행하면서 기존 ruby 서버가 아닌 python 으로 별도의 서버를 띄웠다. Java로 된 별도의 암호화모듈을 사용해야해서 Py4J을 이용했다. 그런데 이 라이브러리의 문제인지 메모리 누수 때문인지 원인은 모르겠
      
    
    </summary>
    
    
      <category term="Server" scheme="https://tuwhit.github.io/tags/Server/"/>
    
      <category term="Lambda" scheme="https://tuwhit.github.io/tags/Lambda/"/>
    
      <category term="node.js" scheme="https://tuwhit.github.io/tags/node-js/"/>
    
      <category term="UptimeRobot" scheme="https://tuwhit.github.io/tags/UptimeRobot/"/>
    
      <category term="Monitoring" scheme="https://tuwhit.github.io/tags/Monitoring/"/>
    
  </entry>
  
  <entry>
    <title>UI와 UX에 대한 개념 정리</title>
    <link href="https://tuwhit.github.io/2017/09/26/til/"/>
    <id>https://tuwhit.github.io/2017/09/26/til/</id>
    <published>2017-09-26T13:48:04.000Z</published>
    <updated>2017-09-26T15:03:21.000Z</updated>
    
    <content type="html"><![CDATA[<hr><p>프로젝트 진행중에 UX 설계를 해볼일이 생겼는데, 디알못이라 뭘 어떻게 해야할지 영 감이 잘 안잡혀서 일단 UI, UX의 개념이라도 정리해봤다.(정리하다보니 생각났는데 옛날에 Human Centered Design 스터디를 한적이 있는데, 그것도 UX Design에 속하는 거였나 싶음)</p><h3 id="UI-User-Interface"><a href="#UI-User-Interface" class="headerlink" title="UI(User Interface)"></a>UI(User Interface)</h3><ul><li>일련의 화면, 페이지 및 장치와 상호작용할 때 사용하는 시각적 요소</li></ul><h3 id="UX-User-Experience"><a href="#UX-User-Experience" class="headerlink" title="UX(User Experience)"></a>UX(User Experience)</h3><ul><li>회사, 서비스 및 제품과 상호 작용하는 사용자의 경험</li><li>UX Design<ul><li>실제 필드에서 사용자를 관찰하고, 그 결과를 바탕으로 디자인</li><li>누가, 왜, 무엇을, 어떻게 사용하는지를 고려해야함</li><li>어떤 목적인지, 어떤 의도가 있는지, 어떻게 쓰였으면 좋겠는지에 대해 고민 필요</li></ul></li></ul><h3 id="UI와-UX의-차이점-에-대한-전문가들의-생각"><a href="#UI와-UX의-차이점-에-대한-전문가들의-생각" class="headerlink" title="UI와 UX의 차이점(에 대한 전문가들의 생각)"></a>UI와 UX의 차이점<del>(에 대한 전문가들의 생각)</del></h3><ul><li>UX는 문제를 해결하기위한 사용자의 여정에 포커스를 두고 UI는 제품 표면의 모습과 기능에 초점을 맞춘다. - Ken Norton</li><li>UX 디자이너는 디자인 프로세스의 개념적 측면에 관심을 가지기 때문에 UI 디자이너는 보다 확실한 요소에 집중할 수 있다. - Andy Budd</li><li>UX와 UI 디자인은 서로 비교할 수 없는 두가지이므로 차이가 없다. -Craig Morrision</li><li>UI는 일반적으로 화면 주변의 시각적 디자인 및 정보 디자인에 관한것이다. UX는 완벽한 경험에 관한 것이므로 화면과 관련이 없을 수 있다. - Patrick Neema</li><li>UI는 제품에 중점을 두고 있으며 일련의 스냅샷을 제시간에 제공한다. UX는 사용자 및 제품을 통한 이동에 초점을 맞춘다. - Scott Jenson</li><li>UX는 사용자가 제품을 사용하여 얻은 전반적인 경험이며 UI는 사용자가 실제로 상호 작용하고 볼수있는 것이다. - Clayton Yan</li></ul><p>API 로직을 고려하면서 UX 설계를 하려니 쉬운일이 아닌것같다. UX를 우선으로 하자니 로직 개선하기가 빡세고, 쉽게 가자니 UX가 좋지 않은것 같고… 엉엉</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;p&gt;프로젝트 진행중에 UX 설계를 해볼일이 생겼는데, 디알못이라 뭘 어떻게 해야할지 영 감이 잘 안잡혀서 일단 UI, UX의 개념이라도 정리해봤다.(정리하다보니 생각났는데 옛날에 Human Centered Design 스터디를 한적이 있는데
      
    
    </summary>
    
    
      <category term="UI" scheme="https://tuwhit.github.io/tags/UI/"/>
    
      <category term="UX" scheme="https://tuwhit.github.io/tags/UX/"/>
    
      <category term="Design" scheme="https://tuwhit.github.io/tags/Design/"/>
    
  </entry>
  
  <entry>
    <title>블로그 개설</title>
    <link href="https://tuwhit.github.io/2017/09/24/first-post/"/>
    <id>https://tuwhit.github.io/2017/09/24/first-post/</id>
    <published>2017-09-24T12:00:45.000Z</published>
    <updated>2017-09-26T12:21:32.000Z</updated>
    
    <content type="html"><![CDATA[<hr><p><a href="https://pages.github.com/" target="_blank" rel="external">Github Pages</a>, <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a> 로 블로그 개설! <a href="https://jekyllrb-ko.github.io/" target="_blank" rel="external">Jekyll</a>을 이용해서 만들까 하다가 Ruby는 회사에서 많이 쓰니 Node.js 기반인 Hexo로 선택했다. 근데 뭐 Node.js 까막눈이어도 눈칫껏 만져보니 기존 테마에 살짝 커스텀하는 정도는 금방 하는듯. Markdown 문법도 잘 몰라서 <a href="https://gist.github.com/ihoneymon/652be052a0727ad59601" target="_blank" rel="external">Markdown 작성법</a> 보면서 이래저래 써보는 중인데 꽤 재밌다. 블로그 메뉴를 어떻게 나눌지, footer 엔 어떤 위젯을 넣을지, 로고는 뭘로 할지 고민. 10대때 열심히 네이버 블로그 꾸미던 시절 생각난다. 하악하악 재밌어!</p><p><a href="https://github.com/GallenHu/hexo-theme-Daily/wiki" target="_blank" rel="external">Daily 테마 위키</a>에 comment field 추가하려면 <code>_config.yml</code> 파일에<br><code>disqus_shortname: your-disqus-shortname</code> 만 추가해주면 된다고 했는데 코멘트 영역이 안뜸…^ㅅㅠ 다행히 <a href="https://disqus.com/" target="_blank" rel="external">disqus 홈페이지</a>에 들어가보니 site - installation 메뉴에 코드가 제공돼있었다.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;div id=<span class="string">"disqus_thread"</span>&gt;&lt;/div&gt;</div><div class="line">&lt;script&gt;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.</span></div><div class="line"><span class="comment">*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/</span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">var disqus_config = function () &#123;</span></div><div class="line"><span class="comment">this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable</span></div><div class="line"><span class="comment">this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable</span></div><div class="line"><span class="comment">&#125;;</span></div><div class="line"><span class="comment">*/</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// DON'T EDIT BELOW THIS LINE</span></div><div class="line"><span class="keyword">var</span> d = <span class="built_in">document</span>, s = d.createElement(<span class="string">'script'</span>);</div><div class="line">s.src = <span class="string">'https://tuwhit.disqus.com/embed.js'</span>;</div><div class="line">s.setAttribute(<span class="string">'data-timestamp'</span>, +<span class="keyword">new</span> <span class="built_in">Date</span>());</div><div class="line">(d.head || d.body).appendChild(s);</div><div class="line">&#125;)();</div><div class="line">&lt;<span class="regexp">/script&gt;</span></div><div class="line"><span class="regexp">&lt;noscript&gt;Please enable JavaScript to view the &lt;a href="https:/</span><span class="regexp">/disqus.com/</span>?ref_noscript<span class="string">"&gt;comments powered by Disqus.&lt;/a&gt;&lt;/noscript&gt;</span></div></pre></td></tr></table></figure></p><p>Disqus가 들어갈 부분에 위 코드를 넣으니 해결!</p><p>테마 적용후 deploy 했는데 반영되는데 시간이 꽤 걸리나보다. 계속 깨져보이길래 제대로 deploy 안된줄알고 구글링중이었는데, 몇분 지나니까 잘 반영돼 있음.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;p&gt;&lt;a href=&quot;https://pages.github.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Github Pages&lt;/a&gt;, &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=
      
    
    </summary>
    
    
      <category term="blog" scheme="https://tuwhit.github.io/tags/blog/"/>
    
      <category term="github" scheme="https://tuwhit.github.io/tags/github/"/>
    
      <category term="hexo" scheme="https://tuwhit.github.io/tags/hexo/"/>
    
  </entry>
  
</feed>
